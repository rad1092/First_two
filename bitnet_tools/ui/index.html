<!doctype html>
<html lang="ko">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>BitNet CSV Analyzer</title>
    <link rel="stylesheet" href="/styles.css" />
  </head>
  <body>
    <main class="container">
      <h1>BitNet CSV Analyzer</h1>
      <p class="sub">입력 1개 → 실행 → 결과 카드 확인</p>

      <section class="panel simple-panel">
        <h2>요청 입력</h2>
        <textarea id="question" rows="3" placeholder="예: 핵심 인사이트 3개 요약해줘"></textarea>
        <div class="actions">
          <button id="quickAnalyzeBtn">실행</button>
        </div>
        <input id="model" placeholder="bitnet:latest" class="advanced-only" />
        <button id="runBtn" class="advanced-only">BitNet 실행</button>
        <textarea id="intent" class="advanced-only" rows="2" placeholder="intent"></textarea>
        <div id="intentActions" class="actions intent-actions" aria-live="polite"></div>
        <button id="analyzeBtn" class="advanced-only">분석</button>
      </section>

      <section class="panel">
        <h2>결과 카드</h2>
        <div class="card result-card">
          <strong>핵심 결과</strong>
          <pre id="summary" aria-live="polite">실행하면 핵심 결과가 여기에 표시됩니다.</pre>
        </div>

        <details id="codeDetails" hidden>
          <summary>코드 보기</summary>
          <pre id="prompt"></pre>
        </details>

        <details>
          <summary>고급 디버그 / 원본 JSON</summary>
          <pre id="schemaMappings">자동 매핑 결과가 여기에 표시됩니다.</pre>
          <pre id="rawJson"></pre>
          <pre id="answer"></pre>
          <pre id="statusBox" aria-live="polite">대기 중</pre>
          <div id="errorUser" class="error-user" aria-live="polite"></div>
          <details id="errorDetails" class="error-details">
            <summary>상세 오류 보기</summary>
            <pre id="errorDetailText"></pre>
          </details>
        </details>
      </section>

      <details class="panel">
        <summary>입력 데이터(파일/CSV)</summary>
        <label>파일 타입</label>
        <select id="inputType">
          <option value="auto">자동 감지</option>
          <option value="csv">CSV</option>
          <option value="excel">Excel (.xlsx/.xls)</option>
          <option value="document">문서 (.pdf/.docx/.pptx)</option>
        </select>
        <label>CSV/Excel 파일</label>
        <input id="csvFile" type="file" accept=".csv,text/csv,.xlsx,.xls,.pdf,.docx,.pptx,application/vnd.ms-excel,application/vnd.openxmlformats-officedocument.spreadsheetml.sheet,application/pdf,application/vnd.openxmlformats-officedocument.wordprocessingml.document,application/vnd.openxmlformats-officedocument.presentationml.presentation" />
        <label>Excel 시트 / 문서 테이블(선택)</label>
        <div class="row">
          <select id="sheetSelect"><option value="">기본 시트(첫 번째)</option></select>
          <button id="refreshSheetsBtn" type="button">목록 새로고침</button>
        </div>
        <textarea id="csvText" rows="8" placeholder="또는 CSV 내용을 직접 붙여넣기"></textarea>
      </details>

      <section class="advanced-only" hidden>
        <button class="mode-btn active" data-mode="quick" id="modeQuickBtn">빠른 시작</button>
        <button class="mode-btn" data-mode="advanced" id="modeAdvancedBtn">고급 모드</button>
        <ol id="modeGuide" class="quick-guide" aria-live="polite"></ol>
        <button id="showVizOptionsBtn" type="button">시각화 옵션 보기</button>
        <pre id="vizRecommendation"></pre>
        <button id="copyPrompt">복사</button>
        <button id="switchToCsvBtn" type="button">CSV 업로드로 전환</button>
        <span id="confidenceBadge" class="chip">신뢰도 낮음</span>
        <p id="analyzeRecommendation" class="sub"></p>
        <div id="analyzeAssist"></div>
        <div id="candidateTableWrap"><select id="candidateTableSelect"></select><pre id="candidateTablePreview"></pre></div>
        <input id="multiCsvFiles" type="file" multiple />
        <input id="groupColumn" />
        <input id="targetColumn" />
        <button id="multiAnalyzeBtn">멀티 분석 실행</button>
        <button id="startChartsJobBtn">차트 비동기 생성 시작</button>
        <button id="retryChartsJobBtn">차트 실패 재시도</button>
        <pre id="chartsJobStatus"></pre>
        <button id="retryPreprocessBtn">전처리 실패 재시도</button>
        <pre id="preprocessStatus"></pre>
        <textarea id="dashboardJson"></textarea>
        <button id="renderDashboardBtn">대시보드 렌더링</button>
        <div id="dashboardCards"></div>
        <select id="filterFile"></select>
        <input id="filterColumn" />
        <select id="filterType"></select>
        <div id="insightList"></div>
        <pre id="reasonCandidates"></pre>
        <pre id="insightDrilldown"></pre>
        <pre id="dashboardInsights"></pre>
        <input id="geoLatCol" />
        <input id="geoLonCol" />
        <input id="geoThreshold" type="number" value="25" />
        <button id="geoExtractBtn" type="button">의심 케이스 추출 다운로드</button>
        <pre id="geoResult"></pre>
      </section>
    </main>
    <script src="/app.js"></script>
  </body>
</html>
